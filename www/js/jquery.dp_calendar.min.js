(function(e){e.fn.dp_calendar=function(t){function Z(e,t,n,r){var i="",s,o;o=function(e,t){var n="",r;while(n.length<t){n+=e}n=n.substr(0,t);return n};e+="";n=n!==undefined?n:" ";if(r!=="STR_PAD_LEFT"&&r!=="STR_PAD_RIGHT"&&r!=="STR_PAD_BOTH"){r="STR_PAD_RIGHT"}if((s=t-e.length)>0){if(r==="STR_PAD_LEFT"){e=o(n,s)+e}else if(r==="STR_PAD_RIGHT"){e=e+o(n,s)}else if(r==="STR_PAD_BOTH"){i=o(n,Math.ceil(s/2));e=i+e+i;e=e.substr(0,t)}}return e}function et(e,t,n){var r="",i=!!n;if(i){for(r in t){if(t[r]===e){return true}}}else{for(r in t){if(t[r]==e){return true}}}return false}function tt(){var t,n,r;R=o.getDay();U=e.datepicker.regional[""].dayNames[R];z=o.getDate();X=o.getMonth();V=e.datepicker.regional[""].monthNames[X];W=e.datepicker.regional[""].monthNamesShort[X];J=o.getFullYear();e.fn.dp_calendar.date_selected=o;e.fn.dp_calendar.order_by=u;e.fn.dp_calendar.format_ampm=a;e.fn.dp_calendar.time_format=time_format;e.fn.dp_calendar.curr_day=R;e.fn.dp_calendar.curr_day_name=U;e.fn.dp_calendar.curr_date=z;e.fn.dp_calendar.curr_month=X;e.fn.dp_calendar.curr_month_name=V;e.fn.dp_calendar.curr_month_name_short=W;e.fn.dp_calendar.curr_year=J;e(K).html("");if(u===1){i.sort(function(e,t){ax=Date.UTC(0,0,0,e["startDate"].getHours(),e["startDate"].getMinutes());bx=Date.UTC(0,0,0,t["startDate"].getHours(),t["startDate"].getMinutes());return ax==bx?0:ax<bx?-1:1})}if(u===2){i.sort(function(e,t){e=e["title"].toLowerCase();t=t["title"].toLowerCase();return e==t?0:e<t?-1:1})}if(u===3){i.sort(function(e,t){e=e["priority"];t=t["priority"];return e==t?0:e>t?-1:1})}for(r=1;r<=(new Date(J,X+1,0)).getDate();r++){t=e("<li />");if(z===r){t.addClass("active")}n=document.createTextNode(Z(r,2,"0","STR_PAD_LEFT"));e(t).html(n).attr("id","dpEventsCalendar_li_"+Date.UTC(J,X,r));e(K).append(t)}if(date_range_start!=null){if(date_range_start.getMonth()==X){jQuery(e(L).find("li:lt("+(date_range_start.getDate()-1)+")")).addClass("dp_calendar_edisabled");e(N).hide()}else{e(N).show()}q.datepicker("option",{minDate:date_range_start})}if(date_range_end!=null){if(date_range_end.getMonth()==X){jQuery(e(L).find("li:gt("+(date_range_end.getDate()-1)+")")).addClass("dp_calendar_edisabled");e(k).hide()}else{e(k).show()}q.datepicker("option",{maxDate:date_range_end})}e(e(K).find("li:not(.dp_calendar_edisabled)")).click(function(t){o=new Date(J,X,e(this).html());e(e(K).find("li:not(.dp_calendar_edisabled)")).each(function(e){this.className=""});this.className="active";tt();d()});e(_).html("");e(_).append("<h1>"+U+"</h1>");e(_).append('<div class="div_month"><span class="span_month">'+W+'</span><br><span class="span_day">'+Z(z,2,"0","STR_PAD_LEFT")+"</span></div>");q.datepicker("setDate",o);e(C).html(V+" "+J);e(I).html("<div class='loading'></div>");Q=0;e(i).each(function(t){if(typeof this=="object"){var n=this["startDate"],r=this["endDate"];event_to_time=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate());event_to_time_date_selected=Date.UTC(o.getFullYear(),o.getMonth(),o.getDate());if(typeof r=="object"){event_to_time_end=Date.UTC(r.getFullYear(),r.getMonth(),r.getDate())}else{event_to_time_end=event_to_time_date_selected+9999999999}event_date=n.getDate();event_month=n.getMonth();event_year=n.getFullYear();G=false;if(this["frequency"]>0){this["frecuency"]=this["frequency"]}if(event_to_time_date_selected>=Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())&&this["frecuency"]>0){switch(this["frecuency"]){case 1:if(event_to_time_date_selected<=event_to_time_end){G=true}break;case 2:calc_multiplo=(event_to_time_date_selected-event_to_time)%7;if(calc_multiplo==0&&event_to_time_date_selected<=event_to_time_end){G=true}break;case 3:if(o.getDate()==n.getDate()&&event_to_time_date_selected<=event_to_time_end){G=true}break;case 4:if(o.getDate()==n.getDate()&&o.getMonth()==n.getMonth()&&event_to_time_date_selected<=event_to_time_end){G=true}break}}if(J===n.getFullYear()&&X===n.getMonth()){e(K).children("li")[n.getDate()-1].className=e(e(K).children("li:not(.dp_calendar_edisabled)")[n.getDate()-1]).className=="active"?"active":"has_events"}if(this["frecuency"]>0){switch(this["frecuency"]){case 1:e(K).find("li").each(function(t){var n=e(this).attr("id").replace("dpEventsCalendar_li_","");if(n>event_to_time&&n<=event_to_time_end){e(this).not(".dp_calendar_edisabled").addClass(e(this).hasClass("active")?"active":"has_events")}});break;case 2:e(K).find("li").each(function(t){var n=e(this).attr("id").replace("dpEventsCalendar_li_","");if(n>event_to_time&&n<=event_to_time_end&&(n-event_to_time)%7==0){e(this).not(".dp_calendar_edisabled").addClass(e(this).hasClass("active")?"active":"has_events")}});break;case 3:e(K).find("li").each(function(t){var n=e(this).attr("id").replace("dpEventsCalendar_li_","");if(n>event_to_time&&n<=event_to_time_end&&(new Date(parseInt(n)+864e5)).getDate()==event_date){e(this).not(".dp_calendar_edisabled").addClass(e(this).hasClass("active")?"active":"has_events")}});break;case 4:e(K).find("li").each(function(t){var n=e(this).attr("id").replace("dpEventsCalendar_li_","");if(n>event_to_time&&n<=event_to_time_end&&(new Date(parseInt(n)+864e5)).getDate()==event_date&&(new Date(parseInt(n))).getMonth()==event_month){e(this).not(".dp_calendar_edisabled").addClass(e(this).hasClass("active")?"active":"has_events")}});break}}if(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate())===Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())||G){var i,s,u,f;if(Q===0){e(I).html("")}Q++;i=e("<li />");if(this["priority"]==1){e(i).addClass("low")}else if(this["priority"]==2){e(i).addClass("medium")}else{e(i).addClass("urgent")}e(I).append(i);s=e("<div />").addClass("time");if(this["allDay"]){e(s).html(DP_LBL_ALL_DAY)}else{if(!a){e(s).html(n.toString(time_format)+(show_end_time?" - "+r.toString(time_format):""))}else{e(s).html(n.toString(time_format.replace("HH","h").replace("H","h")+" tt")+(show_end_time?" - "+r.toString(time_format.replace("HH","h").replace("H","h")+" tt"):""))}}u=e("<h1 />");if(l){e(i).html(s)}e(u).append(this["title"]);O=e("<div />").addClass("clear");f=e("<p />");e(f).html(this["description"]);e(i).append(u);e(i).append(O);e(i).append(f);e(i).append(e("<div />").addClass("clear"))}}});e(e(I).find("li")).click(function(t){m({title:e(this).find("h1").html(),description:e(this).find("p").html(),time:e(this).find("div.time").html(),date:o});if(e(this).find("p").html()==""){return false}if(e(this).find("p").css("display")==="none"){e(this).find("p").slideDown(300)}else{e(this).find("p").slideUp(300)}});if(Q===0){e(I).html(g);}}function nt(t){t.addClass("dp_calendar");t.html("");x=e("<div />").addClass("div_main_date");T=e("<div />").addClass("main_date");e(x).append(T);N=e("<a />").attr({href:"javascript:void(0);",id:"prev_month"}).html("«");C=e("<a />").attr({href:"javascript:void(0);",id:"toggleDP"});k=e("<a />").attr({href:"javascript:void(0);",id:"next_month"}).html("»");e(T).append(N);e(T).append(C);e(T).append(k);t.append(x);L=e("<div />").addClass("div_dates");A=e("<ul />").attr("id","list_days");K=A;O=e("<div />").addClass("clear");_=e("<div />").addClass("day_name").attr("id","day_name");e(L).append(K);M=e("<div />").addClass("clear");e(L).append(M);e(L).append(_);M=e("<div />").addClass("clear");e(L).append(M);t.append(L);D=e("<div />").addClass("calendar_list");H=e("<ul />").attr("id","cl_sort_by");B=e("<li />");if(u===1){B.addClass("active")}e(B).html(b);j=e("<li />");if(u===2){j.addClass("active")}e(j).html(w);F=e("<li />");if(u===3){F.addClass("active")}e(F).html(E);e(H).append(B);e(H).append(j);if(c){e(H).append(F)}I=e("<ul />").attr("id","list");if(h){P=e("<h2 />");e(P).html(y);e(D).append(P);e(D).append(H)}else{P=e("<h2 />");e(P).html(S);e(D).append(P)}e(D).append(O);e(D).append(I);t.append(D);q=e("<input type='text' />").hide().datepicker({onSelect:function(e,t){o=new Date(e);tt()}}).appendTo("body");e(C).click(function(e){if(f===true){if(q.datepicker("widget").is(":hidden")){q.datepicker("show");q.datepicker("widget").position({my:"top",at:"top",of:this})}else{q.hide()}}v();e.preventDefault()});tt();e(k).click(function(e){o=o.add(1).month();tt();p()});e(N).click(function(e){o=o.add(-1).month();tt();p()});e(e(H).find("li")).click(function(t){e(e(H).find("li")).each(function(e){this.className=""});this.className="active";e(e(H).find("li")).each(function(e){if(this.className==="active"){u=e+1}});tt()})}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,g,y,b,w,E,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,J,K,Q,G=false;r=e.extend({},e.fn.dp_calendar.defaults,t);i=r.events_array;s=r.json;o=r.date_selected;u=r.order_by;a=r.format_ampm;time_format=r.time_format;f=r.show_datepicker;c=r.show_priorities;h=r.show_sort_by;l=r.show_time;show_end_time=r.show_end_time;p=r.onChangeMonth;d=r.onChangeDay;v=r.onClickMonthName;m=r.onClickEvents;date_range_start=r.date_range_start;date_range_end=r.date_range_end;n=this;S=e.fn.dp_calendar.regional[""]["DP_LBL_EVENTS"];g=e.fn.dp_calendar.regional[""]["DP_LBL_NO_ROWS"];y=e.fn.dp_calendar.regional[""]["DP_LBL_SORT_BY"];b=e.fn.dp_calendar.regional[""]["DP_LBL_TIME"];w=e.fn.dp_calendar.regional[""]["DP_LBL_TITLE"];DP_LBL_ALL_DAY=e.fn.dp_calendar.regional[""]["DP_LBL_ALL_DAY"];E=e.fn.dp_calendar.regional[""]["DP_LBL_PRIORITY"];if(s!=""&&s!=null){var Y="";e.ajax({url:s,success:function(t){Y=t;var r=e.parseJSON(Y);i=new Array;for(var s in r.events_array){var p=r.events_array[s].startDate;var d=p.split(" ");var v=d[0].split("-");var m=d[1].split(":");var p=new Date(v[0],v[1]-1,v[2],m[0],m[1]);var g=r.events_array[s].endDate;var y=g.split(" ");var b=y[0].split("-");if(y.length>1){var w=y[1].split(":");var g=new Date(b[0],b[1]-1,b[2],w[0],w[1])}else{var g=new Date(b[0],b[1]-1,b[2])}i.push({startDate:p,endDate:g,title:r.events_array[s].title,description:r.events_array[s].description,priority:r.events_array[s].priority,frecuency:typeof r.events_array[s].frecuency!="undefined"?r.events_array[s].frecuency:r.events_array[s].frequency})}if(typeof r.date_selected!=="undefined"){var E=r.date_selected;var v=E.split("-");var E=new Date(v[0],v[1]-1,v[2]);o=new Date(E)}if(typeof r.order_by!=="undefined"){u=r.order_by}if(typeof r.format_ampm!=="undefined"){a=r.format_ampm}if(typeof r.time_format!=="undefined"){time_format=r.time_format}if(typeof r.show_datepicker!=="undefined"){f=r.show_datepicker}if(typeof r.show_priorities!=="undefined"){c=r.show_priorities}if(typeof r.show_sort_by!=="undefined"){h=r.show_sort_by}if(typeof r.show_time!=="undefined"){l=r.show_time}if(typeof r.show_end_time!=="undefined"){show_end_time=r.show_end_time}if(typeof r.date_range_start!=="undefined"){var S=r.date_range_start;var v=S.split("-");var S=new Date(v[0],v[1]-1,v[2]);date_range_start=r.date_range_start!=""?new Date(S):null}if(typeof r.date_range_end!=="undefined"){var x=r.date_range_end;var v=x.split("-");var x=new Date(v[0],v[1]-1,v[2]);date_range_end=r.date_range_end!=""?new Date(x):null}nt(n)}})}else{nt(n)}};e.fn.dp_calendar.defaults={events_array:new Array,json:"",date_selected:new Date,order_by:1,show_datepicker:true,show_priorities:true,show_sort_by:true,show_time:true,show_end_time:true,format_ampm:false,time_format:"HH:mm",onChangeMonth:function(){},onChangeDay:function(){},onClickMonthName:function(){},onClickEvents:function(){},date_range_start:null,date_range_end:null};e.fn.dp_calendar.date_selected=e.fn.dp_calendar.defaults.date_selected;e.fn.dp_calendar.order_by=e.fn.dp_calendar.defaults.order_by;e.fn.dp_calendar.format_ampm=e.fn.dp_calendar.defaults.format_ampm;e.fn.dp_calendar.time_format=e.fn.dp_calendar.defaults.time_format;e.fn.dp_calendar.curr_day="";e.fn.dp_calendar.curr_day_name="";e.fn.dp_calendar.curr_date="";e.fn.dp_calendar.curr_month="";e.fn.dp_calendar.curr_month_name="";e.fn.dp_calendar.curr_month_name_short="";e.fn.dp_calendar.curr_year="";e.fn.dp_calendar.regional=[];e.fn.dp_calendar.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],DP_LBL_EVENTS:"Events",DP_LBL_NO_ROWS:"No results were found in this date.",DP_LBL_SORT_BY:"SORT BY:",DP_LBL_TIME:"TIME",DP_LBL_TITLE:"TITLE",DP_LBL_ALL_DAY:"All Day",DP_LBL_PRIORITY:"PRIORITY"};e.fn.dp_calendar.setDate=function(t){e.fn.dp_calendar({date_selected:t})};e.fn.dp_calendar.setDay=function(t){e.fn.dp_calendar({date_selected:new Date(e.fn.dp_calendar.curr_year,e.fn.dp_calendar.curr_month,t)})};e.fn.dp_calendar.setMonth=function(t){e.fn.dp_calendar({date_selected:new Date(e.fn.dp_calendar.curr_year,t,e.fn.dp_calendar.curr_date)})};e.fn.dp_calendar.setYear=function(t){e.fn.dp_calendar({date_selected:new Date(t,e.fn.dp_calendar.curr_month,e.fn.dp_calendar.curr_date)})};e.fn.dp_calendar.getDate=function(){return e.fn.dp_calendar.date_selected};e.fn.dp_calendar.getDay=function(){return e.fn.dp_calendar.curr_date};e.fn.dp_calendar.getMonth=function(){return e.fn.dp_calendar.curr_month};e.fn.dp_calendar.getYear=function(){return e.fn.dp_calendar.curr_year}})(jQuery)